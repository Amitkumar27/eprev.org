<!DOCTYPE html><html lang="en"><meta charset="utf-8"><title>The importance of HTML character encoding – Anton Eprev</title><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Not specifying a character encoding of HTML document can negatively impact the page load time."><style>body{margin:0}button,input,select,textarea{margin:0;font-size:100%;font-family:inherit}html{font-size:18px;line-height:1.5;-webkit-text-size-adjust:none;-ms-text-size-adjust:none;text-size-adjust:none}body{color:#222;font-family:Optima,Segoe,Segoe UI,Candara,Calibri,Arial,sans-serif}h1,h2,h3,h4,h5,h6{margin:0 0 1.5rem;font-weight:400;page-break-inside:avoid;text-rendering:optimizeLegibility}h1{text-transform:uppercase;font-size:2rem}h1,h2{line-height:3rem}h2{font-size:1.75rem}h3{font-size:1.5rem}h3,h4{line-height:1.5rem}h4{font-size:1.3rem}h5{font-size:1.16rem}h5,h6{line-height:1.5rem}h6{font-size:1rem}blockquote,ol,p,pre,ul{margin:1.5rem 0}blockquote{padding-left:1rem;border-left:4px solid #eee;font-style:italic}ul{padding-left:0;list-style-position:outside;list-style-type:square}p{-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto}code{font-size:.92rem;font-family:Courier,monospace;line-height:1}abbr{letter-spacing:.1em}a{box-shadow:0 1px currentColor;color:inherit;text-decoration:none}:root{--highlight-color:#aad6d7}@supports (--highlight-color:inherit){a{background-image:linear-gradient(90deg,var(--highlight-color),var(--highlight-color));background-position:0 100%;background-size:1px 1px;background-repeat:repeat-x;box-shadow:0 2px var(--highlight-color)}a:hover{background-size:1px 100%;box-shadow:0 0 0 2px var(--highlight-color);color:#fff}}.g--shady{color:#888}.page{margin:0 auto;padding:1.5rem 0;min-width:320px;max-width:980px}.page__sidebar{display:flex;flex-direction:column;float:left;box-sizing:border-box;padding:0 1rem 0 1.5rem;width:30%}.page__content{box-sizing:border-box;margin-left:30%;padding:0 3rem 0 1rem}.page__user-name{--highlight-color:#ffd400;display:inline-block;margin-bottom:1.5rem;text-transform:none;font-size:2rem;line-height:3rem}.page__user-picture{display:block;margin:0 auto 1.5rem;height:9rem}.post__header{--highlight-color:#ffd400;display:inline-block;margin-bottom:0}.post__content p,.post__content ul{margin-top:0}.post__content .highlight{margin:0;background-color:currentColor;box-shadow:1.5rem 0 currentColor,-1.5rem 0 currentColor;color:#f9f9f9}.highlight code{display:block;overflow:auto;padding:1.5rem 0;font-size:.84rem;line-height:1.5}.post-comments{margin-bottom:1.5rem;padding-top:1.5rem;box-shadow:0 -3px #eee}.post__meta{margin:.75rem 0;text-transform:uppercase;font-size:.83rem;line-height:1.5rem}.post__content-list li{margin-bottom:1.5rem}.post__content .responsive-image{margin:1.5rem auto}.post-special-home{position:relative;font-size:1.5rem;line-height:1.5rem}.post-special-home:before{position:absolute;left:-1rem;content:"\2039"}.archive{padding:0;list-style:none}.archive__item{display:block;margin-bottom:1.5rem}.archive__date{text-transform:uppercase;font-size:.92rem;line-height:1.5rem}.archive__header{--highlight-color:#ffd400;font-size:1.16rem;line-height:1.5rem}.tags{padding:0;list-style:none}.tags__item{display:inline-block;margin-bottom:1.5rem;text-transform:uppercase;font-size:1.16rem;line-height:1.5rem}.tags__item:after{content:"\a0\25aa\a0"}.tags__item:last-child:after{content:""}.responsive-image{position:relative;width:100%}.responsive-image img{position:absolute;left:0;top:0;width:100%}@media (max-width:979px){ul{padding-left:1rem}.page{padding-top:0}.page__sidebar{float:none;margin-bottom:1rem;padding-top:1.5rem;padding-left:1rem;width:auto;box-shadow:0 1px #eee}.page__content{margin-left:auto;padding-right:1rem}.page__user-picture-story{display:flex;align-items:center;margin-bottom:1.5rem}.page__user-picture{flex-shrink:0;margin-bottom:0;padding-right:1rem;width:4.5rem;height:4.5rem}.page__user-name{display:none}.page__nav{order:-1;margin-top:0;padding-left:0}.page__nav li{display:inline-block}.page__nav li:after{content:"\a0\25aa\a0";font-size:1.16rem;line-height:1}.page__nav li:last-child:after{content:""}.post-special-home:before{position:static}.archive__header{line-height:2rem}}@media (max-width:666px){html{font-size:16px}}@media (max-width:359px){html{font-size:14px}}.highlight code{color:#485e76}.highlight .c,.highlight .c1,.highlight .cm,.highlight .cs{color:#a5abb1}.highlight .gp{color:#a5abb1}.highlight .gh,.highlight .gp,.highlight .gs,.highlight .gu{font-weight:700}.highlight .k,.highlight .kc,.highlight .kd,.highlight .kn,.highlight .kr,.highlight .nc,.highlight .ne,.highlight .ni,.highlight .nn,.highlight .nt{color:#5e89b9}.highlight .ow{font-weight:700}.highlight .s,.highlight .s1,.highlight .s2,.highlight .sb,.highlight .sc,.highlight .sd,.highlight .se,.highlight .sh,.highlight .si,.highlight .sr,.highlight .ss,.highlight .sx{color:#c15847}</style><script src="http://eprev.org/assets/main-06443c3525bf3ab71bfa52e5eafa72f1.js" defer="defer"></script><link rel="shortcut icon" href="http://eprev.org/images/icon.png"><link rel="alternate" type="application/atom+xml" title="Feed" href="http://eprev.org/atom.xml"><link rel="canonical" href="http://eprev.org/2017/01/04/the-importance-of-html-character-encoding/"><meta property="og:url" content="http://eprev.org/2017/01/04/the-importance-of-html-character-encoding/"><meta property="og:title" content="The importance of HTML character encoding"><meta property="og:site_name" content="Anton Eprev"><meta property="og:type" content="article"><meta property="og:description" content="Not specifying a character encoding of HTML document can negatively impact the page load time."><meta property="og:image" content="http://eprev.org/images/default-share-image.png"><meta name="twitter:card" content="summary"><meta name="twitter:creator" content="@eprev"><meta name="twitter:title" content="The importance of HTML character encoding"><meta name="twitter:description" content="Not specifying a character encoding of HTML document can negatively impact the page load time."><script>!function(e,n,t,a,o,i,c){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=n.createElement(t),c=n.getElementsByTagName(t)[0],i.async=1,i.src=a,c.parentNode.insertBefore(i,c)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-12144011-2","auto"),ga("send","pageview"),window.addEventListener("error",function(e){ga("send","event","JavaScript Error",e.message,e.filename?e.filename+":"+e.lineno:"N/A",{nonInteraction:1})})</script><div class="page"><div class="page__sidebar"><div class="page__user-picture-story"><a class="page__user-name" href="/">@eprev</a> <svg class="page__user-picture" viewBox="0 0 484 570"><path d="M39 503v67h343v-67H39z" fill="#feffff"/><path d="M10.502 569.5v-41c0-28 37.29-41.04 37.29-41.04L127.5 556.5H150v13H10.502zM367 437h27c19 0 65.5 0 85 83v50H367V437zM255 553.5h33v16h-33v-16z" fill="#ff2600"/><path d="M39 191v282c0 19.5 51.5 84 87 84h171c49 0 85-66.5 85-84V191c0-4-48-80-52-80H90.5c-4 0-51.5 80-51.5 80" fill="#ffd400"/><path d="M38 268.92v-122.5c0-34.5 22.736-33.687 53-34-21.5.5-27.5-28.5-27.5-43.5 0-14.5 0-41.5 29-55.5 28.5-14 69.5 4 69.5 4s-20.5 18-34 51.5c1.5 9.5 9 4 9 4s13-41.5 100-63c95.5-9.5 197-16.5 246.5 0-19.5 66.5-101 103-147 102 46 1 46 34.5 46 34.5v122.5h-64v-157c0 9-216.5 7.5-216.5 7.5v150c-30-.5-64-.5-64-.5z" fill="#ff2600"/><path d="M417 342v-55c0-37-36-37-40-37h-15c-4 0-8 4-8 8v113c0 4 4 8 8 8h15c4 0 40 0 40-37M0 287v55c0 37 36 37 40 37h15c4 0 8-4 8-8V258c0-4-4-8-8-8H40c-4 0-40 0-40 37" fill="#ffd400"/><path d="M150 436v17h116v-17H150" fill="#770b00" data-id="mouth"/><path d="M279 342c-25.5 0-46-20.5-46-46s20.5-46 46-46 46 20.5 46 46-20.5 46-46 46m-142 0c-25.5 0-46-20.5-46-46s20.5-46 46-46 46 20.5 46 46-20.5 46-46 46" fill="#feffff"/><circle cx="137" cy="296" r="24" fill="#aad6d7" data-id="right-eye"/><circle cx="279" cy="296" r="24" fill="#aad6d7" data-id="left-eye"/><path d="M137.5 373c-42 0-76.5-34.5-76.5-76.5S95.5 220 137.5 220c32.003 0 59.65 20.03 71 48.147C219.85 240.03 247.497 220 279.5 220c42 0 76.5 34.5 76.5 76.5S321.5 373 279.5 373c-32.003 0-59.65-20.03-71-48.147C197.15 352.97 169.503 373 137.5 373m-.5-31c25.5 0 46-20.5 46-46s-20.5-46-46-46-46 20.5-46 46 20.5 46 46 46m142 0c25.5 0 46-20.5 46-46s-20.5-46-46-46-46 20.5-46 46 20.5 46 46 46" fill="#770b00"/></svg><div class="page__user-story">My name’s Anton Eprev and I’m a web developer working as front-end engineer at Booking.com in Amsterdam, Netherlands. I’m on <a href="https://twitter.com/eprev">Twitter</a>, <a href="https://github.com/eprev">GitHub</a> and <a href="https://unsplash.com/@eprev">Unsplash</a>.</div></div><ul class="page__nav"><li><a href="/">Home</a></li><li><a href="/archive/">Archive</a></li><li><a href="/tags/">Tags</a></li><li><a href="https://careers.stackoverflow.com/eprev">Résumé</a></li></ul></div><div class="page__content"><div class="post"><h1 class="post__header">The importance of HTML character encoding</h1><div class="post__meta g--shady">January 4, 2017 ∙ <a href="/tags/performance/">performance</a>, <a href="/tags/html/">html</a></div><div class="post__content"><p>W3C/WHATWG HTML5 specification states:</p><blockquote><p>A character encoding declaration is required (…) even when all characters are in the ASCII range, because a character encoding is needed to process non-ASCII characters entered by the user in forms, in URLs generated by scripts, and so forth.</p></blockquote><p>When the character encoding is not specified, the browser is left to determine the encoding <strong>before parsing</strong> the document. The user agent will search for character encoding declarations <a href="https://html.spec.whatwg.org/multipage/semantics.html#charset1024">in the first 1024 bytes</a>. Therefore, if you don’t set the encoding of the document neither in the <code>Content-Type</code> header nor using the <code>META</code> tag, the browser will have to wait for the first 1024 bytes and only then may attempt to auto-detect the character encoding or fallback to the user-specified default character encoding.</p><p>It’s important to specify a character set of the document as earlier as possible, otherwise the user agent will “idle” before it actually can start parsing HTML and loading other important resources (styles and scripts). This negatively impacts the page load time, especially on a slow connection or when the server flushes the early-head. The later can be completely meaningless when it’s under 1024 bytes and the character encoding of the document is not indicated.</p><p>To demonstrate this I made a <a href="https://gist.github.com/eprev/322cd355319483aaaebbb2da35052281">simple HTTP server</a> which flushes early-head of the document immediately and waits for a second before sending the rest of it. The early-head contains a <code>script</code> tag with the <code>async</code> attribute and a <code>link</code> tag to the external stylesheet.</p><figure class="highlight"><pre><code><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"…"</span> <span class="na">async</span>
  <span class="na">onload=</span><span class="s">"console.log({scripts: performance.now()})"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">"…"</span> <span class="na">rel=</span><span class="s">"stylesheet"</span>
  <span class="na">onload=</span><span class="s">"console.log({styles: performance.now()})"</span><span class="nt">&gt;</span>
<span class="nt">&lt;script&gt;</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span>
    <span class="s1">'DOMContentLoaded'</span><span class="p">,</span>
    <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">({</span><span class="na">DOMContentLoaded</span><span class="p">:</span> <span class="nx">performance</span><span class="p">.</span><span class="nx">now</span><span class="p">()})</span>
  <span class="p">);</span>
<span class="nt">&lt;/script&gt;</span></code></pre></figure><p>If the character encoding is specified, then the browser (Firefox in this particular case) begins parsing HTML immediately along with loading external resources. On the image below, you can see that the script and the stylesheet have been loaded before DOM becomes interactive.</p><figure class="responsive-image" style="max-width: 1458px"><div style="padding-bottom: 15.36%"><img src="/images/posts/ff-charset-is-specified.png" alt="Firefox Web Console: Character encoding is specified" layout="responsive"></div></figure><p>When the character encoding is not specified, then the browser starts parsing HTML only after it gets the rest of the document (the first 1024 bytes), causing a delay in loading scripts and stylesheets.</p><figure class="responsive-image" style="max-width: 1458px"><div style="padding-bottom: 23.32%"><img src="/images/posts/ff-charset-is-not-specified.png" alt="Firefox Web Console: Character encoding is not specified" layout="responsive"></div></figure><p>Safari shares similar to Firefox behavior. Chrome and Edge begin parsing HTML right away even if the character encoding is not specified or incorrect.</p><figure class="responsive-image" style="max-width: 1234px"><div style="padding-bottom: 58.83%"><img src="/images/posts/chrome-charset-is-not-specified.png" alt="Chrome Console: Character encoding is not specified" layout="responsive"></div></figure><p>HTML5 specification says that user agents must not support the CESU-8, UTF-7, BOCU-1, SCSU, EBCDIC and UTF-32 encodings. Firefox and Safari won’t parse the document UTF-7 encoded until they get the first 1024 bytes.</p><p>On a final note, it’s important that the character set specified in the <code>Content-Type</code> header or <code>META</code> tag matches the encoding actually used for the document. If the browser detects an incorrect or mismatched encoding, it can re-parse the document with the real encoding resulting in additional delays.</p></div></div><div class="post-comments g--shady">Want to leave a comment on this? Visit <a href="https://github.com/eprev/eprev.org/issues/14">the post’s issue page</a> on GitHub.</div><div class="post-special-home"><a href="/">Home</a></div></div></div></html>