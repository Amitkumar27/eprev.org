<!doctype html><html lang="en"><meta charset="utf-8"><title>The importance of HTML character encoding – Anton Eprev</title><link rel="shortcut icon" href="http://eprev.org/assets/4-eyed-32x32.png"><style>body{margin:0}button,input,select,textarea{margin:0;font-size:100%;font-family:inherit}@font-face{font-weight:300;font-style:normal;font-family:Merriweather Sans;src:local("Merriweather Sans Light"),local("MerriweatherSans-Light"),url(/assets/fonts/merriweathersans-light.woff2) format("woff2"),url(/assets/fonts/merriweathersans-light.woff) format("woff");font-display:fallback}@font-face{font-weight:700;font-style:normal;font-family:Merriweather Sans;src:local("Merriweather Sans Bold"),local("MerriweatherSans-Bold"),url(/assets/fonts/merriweathersans-bold.woff2) format("woff2"),url(/assets/fonts/merriweathersans-bold.woff) format("woff");font-display:fallback}@font-face{font-weight:300;font-style:italic;font-family:Merriweather Sans;src:local("Merriweather Sans Light Italic"),local("MerriweatherSans-LightItalic"),url(/assets/fonts/merriweathersans-lightitalic.woff2) format("woff2"),url(/assets/fonts/merriweathersans-lightitalic.woff) format("woff");font-display:fallback}html{font-size:16px;line-height:1.5;-webkit-text-size-adjust:none;-ms-text-size-adjust:none;text-size-adjust:none}body{color:#222;font-family:Merriweather Sans,Helvetica Neue,Segoe UI,Arial,sans-serif}body,h1,h2,h3,h4,h5,h6{font-weight:300}h1,h2,h3,h4,h5,h6{margin:0 0 1.5rem;page-break-inside:avoid;text-rendering:optimizeLegibility}h1{font-size:2rem}h1,h2{line-height:3rem}h2{font-size:1.75rem}h3{font-size:1.5rem}h3,h4{line-height:1.5rem}h4{font-size:1.3rem}h5{font-size:1.16rem}h5,h6{line-height:1.5rem}h6{font-size:1rem}blockquote,ol,p,pre,ul{margin:1.5rem 0}blockquote{padding-left:1.5rem;font-style:italic}blockquote.epigraph,ul{padding-left:0}ul{list-style-position:outside;list-style-type:square}p{-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto}code{font-family:Courier,monospace;line-height:1}abbr{letter-spacing:.1em}a{background-image:linear-gradient(90deg,#ececec,#ececec);background-position:0 100%;background-size:1px 2px;background-repeat:repeat-x;box-shadow:0 2px #ececec;color:inherit;text-decoration:none}a:hover{background-image:linear-gradient(90deg,#d0e0f0,#d0e0f0);box-shadow:0 2px #d0e0f0}figure{margin:1.5rem 0}figcaption{padding-top:.75rem;color:#888;text-align:center;font-size:.83rem}.page{margin:0 auto;padding:1.5rem 0;padding-right:calc(980px * .3 - 1.5rem);min-width:320px;max-width:980px}.page__sidebar{display:flex;flex-direction:column;float:left;box-sizing:border-box;padding:0 1rem 0 1.5rem;width:30%}.page__content{box-sizing:border-box;margin-left:30%;padding:0 3rem 0 1rem}.page__header{text-align:center}.page__user-name{display:inline-block;margin-bottom:1.5rem;text-transform:none;font-size:2rem;line-height:3rem}.page__user-picture{display:block;margin:0 auto 1.5rem;height:9rem}.page__user-picture-svg{width:100%;height:100%}.post+.post{margin:3rem 0}.post__header{margin-bottom:0;text-align:center}.post__content p,.post__content ul{margin-top:0}.post__read-more{text-align:center;font-size:.92rem;font-style:italic}.highlight code{background-color:currentColor;color:#f9f9f9;display:block;line-height:1.5;padding:0 1.5rem}.highlight .scrollable{padding:1.5rem 0}.highlight pre{margin:0}.scrollable{overflow:auto;position:relative}.scrollable--enabled{overflow:hidden}.scrollbar{position:absolute;background-color:rgba(0,0,0,.05);cursor:default;-webkit-tap-highlight-color:transparent}.scrollbar--active,.scrollbar:hover{background-color:rgba(0,0,0,.1)}.scrollbar--horizontal{height:8px;bottom:0}.post-comments{color:#888;margin:3rem 0 1.5rem;text-align:center}.post-comments__icon{width:1.5rem;height:1.5rem;display:inline-block;vertical-align:middle}.post__meta{color:#888;margin:.75rem 0 2.25rem;text-align:center;font-size:.83rem;line-height:1.5rem}.post__content-list li{margin-bottom:1.5rem}.responsive-image{position:relative;margin:1.5rem auto;width:100%}.responsive-image img{position:absolute;top:0;left:0;width:100%}@media (min-width:980px){@supports (width:calc(100%)){.responsive-image--wide{width:calc(100% + 3rem);transform:translateX(-1.5rem)}.responsive-image--wide figcaption{padding-right:1.5rem;padding-left:1.5rem}}.highlight code{padding:0;box-shadow:1.5rem 0 currentColor,-1.5rem 0 currentColor}}.post-special-archive{position:relative;font-size:1.5rem;line-height:1.5rem}.archive{padding:0;list-style:none}.archive__item{display:block;margin-bottom:1.5rem}.archive__date{color:#888;float:left;padding-right:1rem;width:4rem;font-size:.92rem;text-align:right}.archive__header{margin-left:5rem}.tags{padding:0;list-style:none;text-align:center}.tags__item{display:inline-block;margin-bottom:1.5rem;font-size:1.16rem;line-height:1.5rem}.tags__item:after{content:"\a0\25aa\a0"}.tags__item:last-child:after{content:""}@media (max-width:1367px){ul{padding-left:1.5rem}.page{padding-top:0;padding-right:0;margin:auto;max-width:42rem}.page__sidebar{float:none;margin-bottom:2rem;padding-top:1.5rem;padding-left:1rem;width:auto;box-shadow:0 1px #ececec}.page__content{margin-left:auto;padding-right:1rem}.page__user-picture-story{display:flex;align-items:center;margin-bottom:1.5rem}.page__user-picture{flex-shrink:0;margin-bottom:0;padding-right:1rem;width:4.5rem;height:4.5rem}.page__user-name{display:none}.page__nav{order:-1;margin-top:0;padding-left:0;text-align:center}.page__nav li{display:inline-block}.page__nav li:after{content:"\a0\25aa\a0";font-size:1.16rem;line-height:1}.page__nav li:last-child:after{content:""}.archive__date,.archive__header{line-height:2rem}}@media (max-width:666px){html{font-size:14px}}@media (max-width:359px){html{font-size:12px}}.highlight pre{color:#485e76}.hljs-comment,.hljs-meta{color:#a5abb1}.hljs-strong{font-weight:700}.hljs-built_in,.hljs-keyword,.hljs-variable{color:#5e89b9}.hljs-string{color:#c15847}.hljs-subst{color:#485e76}</style><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Not specifying a character encoding of HTML document can negatively impact the page load time."><link rel="alternate" type="application/atom+xml" title="Feed" href="http://eprev.org/atom.xml"><link rel="canonical" href="http://eprev.org/2017/01/04/the-importance-of-html-character-encoding/"><meta property="og:url" content="http://eprev.org/2017/01/04/the-importance-of-html-character-encoding/"><meta property="og:title" content="The importance of HTML character encoding"><meta property="og:site_name" content="Anton Eprev"><meta property="og:type" content="article"><meta property="og:description" content="Not specifying a character encoding of HTML document can negatively impact the page load time."><meta name="twitter:creator" content="@eprev"><meta name="twitter:title" content="The importance of HTML character encoding"><meta name="twitter:description" content="Not specifying a character encoding of HTML document can negatively impact the page load time."><script src="/assets/build/main-1453f00dcdd77472a6c6cd9ea1eaf107.js" type="module"></script><body><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-12144011-2', {'siteSpeedSampleRate': 100});
        ga('set', 'transport', 'beacon');
        ga('send', 'pageview');
      
      window.addEventListener('error', function(e) {
  ga('send', 'event', 'JavaScript Error', e.message, e.filename ? (e.filename + ':' + e.lineno) : 'N/A', {nonInteraction: 1});
});
if (window.performance && document.hidden !== undefined) {
  var prevTimeStamp = performance.now();
  var timeOnPage = 0;
  var accTimeOnPage = function () {
    if (document.hidden) {
        timeOnPage += Math.round(performance.now() - prevTimeStamp);
    } else {
        prevTimeStamp = performance.now();
    }
  };
  document.addEventListener('visibilitychange', accTimeOnPage);
  window.addEventListener('unload', function () {
    accTimeOnPage();
    ga('send', 'timing', 'Engagement', 'Time On Page', timeOnPage, {transport: 'beacon'});
  });
}
document.body.addEventListener('click', (e) => {
  if (e.target.matches('[data-ga-on=click]')) {
    const data = e.target.dataset;
    ga('send', 'event', data.gaCategory, data.gaAction, data.gaLabel, data.gaValue);
  }
});</script><div class="page"><div class="page__sidebar"><div class="page__user-picture-story"><a class="page__user-name" href="/">@eprev</a><div class="page__user-picture"><svg viewBox="0 0 484 570" width="64" class="page__user-picture-svg"><path d="M39 503v67h343v-67H39z" fill="#feffff"/><path d="M10.502 569.5v-41c0-28 37.29-41.04 37.29-41.04L127.5 556.5H150v13H10.502zM367 437h27c19 0 65.5 0 85 83v50H367V437zM255 553.5h33v16h-33v-16z" fill="#ff2600"/><path d="M39 191v282c0 19.5 51.5 84 87 84h171c49 0 85-66.5 85-84V191c0-4-48-80-52-80H90.5c-4 0-51.5 80-51.5 80" fill="#ffd400"/><path d="M38 268.92v-122.5c0-34.5 22.736-33.687 53-34-21.5.5-27.5-28.5-27.5-43.5 0-14.5 0-41.5 29-55.5 28.5-14 69.5 4 69.5 4s-20.5 18-34 51.5c1.5 9.5 9 4 9 4s13-41.5 100-63c95.5-9.5 197-16.5 246.5 0-19.5 66.5-101 103-147 102 46 1 46 34.5 46 34.5v122.5h-64v-157c0 9-216.5 7.5-216.5 7.5v150c-30-.5-64-.5-64-.5z" fill="#ff2600"/><path d="M417 342v-55c0-37-36-37-40-37h-15c-4 0-8 4-8 8v113c0 4 4 8 8 8h15c4 0 40 0 40-37M0 287v55c0 37 36 37 40 37h15c4 0 8-4 8-8V258c0-4-4-8-8-8H40c-4 0-40 0-40 37" fill="#ffd400"/><path d="M150 436v17h116v-17H150" fill="#770b00" data-id="mouth"/><path d="M279 342c-25.5 0-46-20.5-46-46s20.5-46 46-46 46 20.5 46 46-20.5 46-46 46m-142 0c-25.5 0-46-20.5-46-46s20.5-46 46-46 46 20.5 46 46-20.5 46-46 46" fill="#feffff"/><circle cx="137" cy="296" r="24" fill="#aad6d7" data-id="right-eye" transform="translate(20, 0)"/><circle cx="279" cy="296" r="24" fill="#aad6d7" data-id="left-eye" transform="translate(20, 0)"/><path d="M137.5 373c-42 0-76.5-34.5-76.5-76.5S95.5 220 137.5 220c32.003 0 59.65 20.03 71 48.147C219.85 240.03 247.497 220 279.5 220c42 0 76.5 34.5 76.5 76.5S321.5 373 279.5 373c-32.003 0-59.65-20.03-71-48.147C197.15 352.97 169.503 373 137.5 373m-.5-31c25.5 0 46-20.5 46-46s-20.5-46-46-46-46 20.5-46 46 20.5 46 46 46m142 0c25.5 0 46-20.5 46-46s-20.5-46-46-46-46 20.5-46 46 20.5 46 46 46" fill="#770b00"/></svg></div><div class="page__user-story">My name’s Anton Eprev and I’m a web developer working as front-end engineer at Booking.com in Amsterdam, Netherlands. I’m on <a href="https://twitter.com/eprev">Twitter</a>, <a href="https://github.com/eprev">GitHub</a> and <a href="https://unsplash.com/@eprev">Unsplash</a>.</div></div><ul class="page__nav"><li><a href="/">Home</a></li><li><a href="/archive/">Archive</a></li><li><a href="/tags/">Tags</a></li></ul></div><div class="page__content"><div class="post"><h1 class="post__header">The importance of HTML character encoding</h1><div class="post__meta">January 4, 2017 ∙ 3 minutes read ∙ <a href="/tags/performance/">performance</a>, <a href="/tags/html/">html</a>, <a href="/tags/hacking-web/">hacking-web</a></div><div class="post__content"><p>W3C/WHATWG HTML5 specification states:</p><blockquote><p>A character encoding declaration is required (…) even when all characters are in the ASCII range, because a character encoding is needed to process non-ASCII characters entered by the user in forms, in URLs generated by scripts, and so forth.</p></blockquote><p>When the character encoding is not specified, the browser is left to determine the encoding <strong>before parsing</strong> the document. The user agent will search for character encoding declarations <a href="https://html.spec.whatwg.org/multipage/semantics.html#charset1024">in the first 1024 bytes</a>. Therefore, if you don’t set the encoding of the document neither in the <code>Content-Type</code> header nor using the <code>META</code> tag, the browser will have to wait for the first 1024 bytes and only then may attempt to auto-detect the character encoding or fallback to the user-specified default character encoding.</p><p>It’s important to specify a character set of the document as earlier as possible, otherwise the user agent will “idle” before it actually can start parsing HTML and loading other important resources (styles and scripts). This negatively impacts the page load time, especially on a slow connection or when the server flushes the early-head. The later can be completely meaningless when it’s under 1024 bytes and the character encoding of the document is not indicated.</p><p>To demonstrate this I made a <a href="https://gist.github.com/eprev/322cd355319483aaaebbb2da35052281">simple HTTP server</a> which flushes early-head of the document immediately and waits for a second before sending the rest of it. The early-head contains a <code>script</code> tag with the <code>async</code> attribute and a <code>link</code> tag to the external stylesheet.</p><figure class="highlight"><code><div class="scrollable"><pre><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"…"</span> <span class="hljs-attr">async</span>
  <span class="hljs-attr">onload</span>=<span class="hljs-string">"console.log({scripts: performance.now()})"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"…"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span>
  <span class="hljs-attr">onload</span>=<span class="hljs-string">"console.log({styles: performance.now()})"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
  <span class="hljs-built_in">document</span>.addEventListener(
    <span class="hljs-string">'DOMContentLoaded'</span>,
    () =&gt; <span class="hljs-built_in">console</span>.log({<span class="hljs-attr">DOMContentLoaded</span>: performance.now()})
  );
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></pre></div></code><figcaption>Part of the early-head contents.</figcaption></figure><p>If the character encoding is specified, then the browser (Firefox in this particular case) begins parsing HTML immediately along with loading external resources. On the image below, you can see that the script and the stylesheet have been loaded before DOM becomes interactive.</p><figure class="responsive-image responsive-image--wide" style="max-width: 1458px"><div style="padding-bottom: 15.09%"><a href="http://eprev.org/2017/01/04/the-importance-of-html-character-encoding/ff-charset-is-specified.png"><img src="http://eprev.org/2017/01/04/the-importance-of-html-character-encoding/ff-charset-is-specified.png" alt="Firefox Web Console: Character encoding is specified"></a></div><figcaption>When the character encoding is specified, Firefox starts loading styles and scripts as it is parsing the HTML.</figcaption></figure><p>When the character encoding is not specified, then the browser starts parsing HTML only after it gets the rest of the document (the first 1024 bytes), causing a delay in loading scripts and stylesheets.</p><figure class="responsive-image responsive-image--wide" style="max-width: 1458px"><div style="padding-bottom: 23.18%"><a href="http://eprev.org/2017/01/04/the-importance-of-html-character-encoding/ff-charset-is-not-specified.png"><img src="http://eprev.org/2017/01/04/the-importance-of-html-character-encoding/ff-charset-is-not-specified.png" alt="Firefox Web Console: Character encoding is not specified"></a></div><figcaption>When the character encoding is not specified, Firefox waits for the first 1024 bytes before it begins loading styles and scripts.</figcaption></figure><p>Safari shares similar to Firefox behavior. Things are quite different with Chrome and Edge, they begin parsing HTML right away even if the character encoding is not specified or incorrect.</p><figure class="responsive-image responsive-image--wide" style="max-width: 1234px"><div style="padding-bottom: 58.67%"><a href="http://eprev.org/2017/01/04/the-importance-of-html-character-encoding/chrome-charset-is-not-specified.png"><img src="http://eprev.org/2017/01/04/the-importance-of-html-character-encoding/chrome-charset-is-not-specified.png" alt="Chrome Console: Character encoding is not specified"></a></div><figcaption>Chrome starts parsing the HTML and loading styles and scripts as it is loading the document even if the character encoding is not specified.</figcaption></figure><p>What’s incorrect encoding? HTML5 specification says that user agents must not support the CESU-8, UTF-7, BOCU-1, SCSU, EBCDIC and UTF-32 encodings. For that reason, Firefox and Safari won’t parse the document UTF-7 encoded until they get the first 1024 bytes.</p><p>On a final note, it’s important that the character set specified in the <code>Content-Type</code> header or <code>META</code> tag matches the encoding actually used for the document. If the browser detects an incorrect or mismatched encoding, it can re-parse the document with the real encoding resulting in additional delays.</p></div></div><div class="post-comments" data-issue-id="14"><svg viewBox="0 0 26 26" class="post-comments__icon"><path fill="#888888" d="M 13 0.1875 C 6 0.1875 0.1875 5.25 0.1875 11.625 C 0.1875 14.621094 1.59375 17.257813 3.6875 19.28125 C 3.605469 20.441406 3.023438 21.132813 2.21875 21.8125 C 1.785156 22.175781 1.308594 22.515625 0.875 22.9375 C 0.441406 23.359375 0 23.929688 0 24.71875 C 0 25.175781 0.308594 25.574219 0.75 25.6875 C 2.628906 26.191406 4.648438 25.820313 6.5 25.15625 C 8.164063 24.558594 9.574219 23.671875 10.6875 22.8125 C 11.441406 22.9375 12.203125 23.03125 13 23.03125 C 20 23.03125 25.8125 17.996094 25.8125 11.625 C 25.8125 5.253906 20 0.1875 13 0.1875 Z M 13 2.1875 C 19.046875 2.1875 23.8125 6.476563 23.8125 11.625 C 23.8125 16.773438 19.046875 21.03125 13 21.03125 C 12.214844 21.03125 11.460938 20.984375 10.71875 20.84375 C 10.421875 20.773438 10.113281 20.84375 9.875 21.03125 C 8.972656 21.789063 7.457031 22.703125 5.84375 23.28125 C 4.851563 23.636719 3.84375 23.800781 2.90625 23.84375 C 3.117188 23.675781 3.28125 23.554688 3.53125 23.34375 C 4.539063 22.496094 5.75 21.128906 5.75 19.0625 C 5.75 18.773438 5.625 18.5 5.40625 18.3125 C 3.40625 16.585938 2.1875 14.234375 2.1875 11.625 C 2.1875 6.476563 6.953125 2.1875 13 2.1875 Z "/></svg> <span class="post-comments__text">Want to leave a comment on this? Visit <a href="https://github.com/eprev/eprev.org/issues/14">the&#160;post’s&#160;issue&#160;page</a> on GitHub.</span></div></div></div></body></html>