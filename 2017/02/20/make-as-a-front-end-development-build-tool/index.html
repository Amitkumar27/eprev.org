<!DOCTYPE html><html lang="en"><meta charset="utf-8"><title>Make as a front-end development build tool – Anton Eprev</title><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="A practical introduction to Make as a front-end development build tool."><style>body{margin:0}button,input,select,textarea{margin:0;font-size:100%;font-family:inherit}@font-face{font-weight:400;font-style:normal;font-family:Merriweather;src:local("Merriweather Regular"),local("Merriweather-Regular"),url(/fonts/merriweather-regular.woff2) format("woff2"),url(/fonts/merriweather-regular.woff) format("woff")}@font-face{font-weight:300;font-style:normal;font-family:Merriweather Sans;src:local("Merriweather Sans Light"),local("MerriweatherSans-Light"),url(/fonts/merriweathersans-light.woff2) format("woff2"),url(/fonts/merriweathersans-light.woff) format("woff")}@font-face{font-weight:700;font-style:normal;font-family:Merriweather Sans;src:local("Merriweather Sans Bold"),local("MerriweatherSans-Bold"),url(/fonts/merriweathersans-bold.woff2) format("woff2"),url(/fonts/merriweathersans-bold.woff) format("woff")}@font-face{font-weight:300;font-style:italic;font-family:Merriweather Sans;src:local("Merriweather Sans Light Italic"),local("MerriweatherSans-LightItalic"),url(/fonts/merriweathersans-lightitalic.woff2) format("woff2"),url(/fonts/merriweathersans-lightitalic.woff) format("woff")}html{font-size:16px;line-height:1.5;-webkit-text-size-adjust:none;-ms-text-size-adjust:none;text-size-adjust:none}body{color:#222;font-weight:300;font-family:Helvetica Neue,Segoe UI,Arial,sans-serif}.g--ff-serif,h1,h2,h3,h4,h5,h6{font-weight:400;font-family:Georgia,serif}h1,h2,h3,h4,h5,h6{margin:0 0 1.5rem;page-break-inside:avoid;text-rendering:optimizeLegibility}.fonts-loaded body{font-family:Merriweather Sans,Helvetica Neue,Segoe UI,Arial,sans-serif}.fonts-loaded .g--ff-serif,.fonts-loaded h1,.fonts-loaded h2,.fonts-loaded h3,.fonts-loaded h4,.fonts-loaded h5,.fonts-loaded h6{font-family:Merriweather,Georgia,serif}h1{font-size:2rem}h1,h2{line-height:3rem}h2{font-size:1.75rem}h3{font-size:1.5rem}h3,h4{line-height:1.5rem}h4{font-size:1.3rem}h5{font-size:1.16rem}h5,h6{line-height:1.5rem}h6{font-size:1rem}blockquote,ol,p,pre,ul{margin:1.5rem 0}blockquote{padding-left:1.5rem;font-style:italic}blockquote.epigraph{padding-left:0;text-align:right}ul{padding-left:0;list-style-position:outside;list-style-type:square}p{-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto}code{font-size:.92rem;font-family:Courier,monospace;line-height:1}p code,ul code{background-color:#f9f9f9;padding:2px 4px}a>code{background-color:transparent}abbr{letter-spacing:.1em}a{background-image:linear-gradient(90deg,#ececec,#ececec);background-position:0 100%;background-size:1px 2px;background-repeat:repeat-x;box-shadow:0 2px #ececec;color:inherit;text-decoration:none}a:hover{background-image:linear-gradient(90deg,#d0e0f0,#d0e0f0);box-shadow:0 2px #d0e0f0}figure{margin:1.5rem 0}figcaption{padding-top:.75rem;color:#888;text-align:center;font-size:.83rem}.g--shady{color:#888}.g--border{box-shadow:0 0 0 1px #ccc}.page{margin:0 auto;padding:1.5rem 0;min-width:320px;max-width:980px}.page__sidebar{display:flex;flex-direction:column;float:left;box-sizing:border-box;padding:0 1rem 0 1.5rem;width:30%}.page__content{box-sizing:border-box;margin-left:30%;padding:0 3rem 0 1rem}.page__header{text-align:center}.page__user-name{display:inline-block;margin-bottom:1.5rem;text-transform:none;font-size:2rem;line-height:3rem}.page__user-picture{display:block;margin:0 auto 1.5rem;height:9rem}.post+.post{margin:3rem 0}.post__header{margin-bottom:0;text-align:center}.post__content p,.post__content ul{margin-top:0}.post__content h2{box-shadow:0 1px #ececec}.post__read-more{text-align:center;font-size:.92rem;font-style:italic}.highlight pre{margin:0;padding:0 1.5rem;background-color:currentColor;color:#f9f9f9}.highlight code{display:block;overflow:auto;padding:1.5rem 0;line-height:1.5;box-shadow:none;background-color:transparent}.post-share{padding:1.5rem 0;box-sizing:border-box;border-top:1px solid #ececec;border-bottom:1px solid #ececec;margin-bottom:1.5rem;font-size:.92rem;text-align:center}.post-share__icon{width:1.5rem;height:1.5rem;line-height:1.5rem;display:inline-block;vertical-align:middle}.post-comments{margin-bottom:1.5rem}.post__meta{margin:.75rem 0 2.25rem;text-align:center;font-size:.83rem;line-height:1.5rem}.post__content-list li{margin-bottom:1.5rem}.responsive-image{position:relative;margin:1.5rem auto;width:100%}.responsive-image img{position:absolute;top:0;left:0;width:100%}@media (min-width:980px){@supports (width:calc(100%)){.responsive-image--wide{width:calc(100% + 3rem);transform:translateX(-1.5rem)}.responsive-image--wide figcaption{padding-right:1.5rem;padding-left:1.5rem}}.highlight pre{padding:0;box-shadow:1.5rem 0 currentColor,-1.5rem 0 currentColor}}.post-special-archive,.post-special-home{position:relative;font-size:1.5rem;line-height:1.5rem}.post-special-home:before{position:absolute;left:-1rem;content:"\2039"}.archive{padding:0;list-style:none}.archive__item{display:block;margin-bottom:1.5rem}.archive__date{float:left;padding-right:1rem;width:4rem;font-size:.92rem;text-align:right}.archive__header{margin-left:5rem}.tags{padding:0;list-style:none;text-align:center}.tags__item{display:inline-block;margin-bottom:1.5rem;font-size:1.16rem;line-height:1.5rem}.tags__item:after{content:"\a0\25aa\a0"}.tags__item:last-child:after{content:""}@media (max-width:979px){ul{padding-left:1rem}.page{padding-top:0;margin:auto;max-width:42rem}.page__sidebar{float:none;margin-bottom:1rem;padding-top:1.5rem;padding-left:1rem;width:auto;box-shadow:0 1px #ececec}.page__content{margin-left:auto;padding-right:1rem}.page__user-picture-story{display:flex;align-items:center;margin-bottom:1.5rem}.page__user-picture{flex-shrink:0;margin-bottom:0;padding-right:1rem;width:4.5rem;height:4.5rem}.page__user-name{display:none}.page__nav{order:-1;margin-top:0;padding-left:0;text-align:center}.page__nav li{display:inline-block}.page__nav li:after{content:"\a0\25aa\a0";font-size:1.16rem;line-height:1}.page__nav li:last-child:after{content:""}.post-special-home:before{position:static}.archive__date,.archive__header{line-height:2rem}}@media (max-width:666px){html{font-size:14px}}@media (max-width:359px){html{font-size:12px}}@media (min-width:1440px){.page{padding-right:calc(980px * .3 - 1.5rem)}}.highlight code{color:#485e76}.highlight .c,.highlight .c1,.highlight .cm,.highlight .cs{color:#a5abb1}.highlight .gp{color:#a5abb1}.highlight .gh,.highlight .gp,.highlight .gs,.highlight .gu{font-weight:700}.highlight .k,.highlight .kc,.highlight .kd,.highlight .kn,.highlight .kr,.highlight .nc,.highlight .ne,.highlight .ni,.highlight .nl,.highlight .nn,.highlight .nt{color:#5e89b9}.highlight .ow{font-weight:700}.highlight .s,.highlight .s1,.highlight .s2,.highlight .sb,.highlight .sc,.highlight .sd,.highlight .se,.highlight .sh,.highlight .si,.highlight .sr,.highlight .ss,.highlight .sx{color:#c15847}.highlight--lang-make .s1,.highlight--lang-make .s2{color:inherit}</style><script src="http://eprev.org/assets/main-a2f40c69875a90f46f961febe52d4989.js" defer="defer"></script><link rel="shortcut icon" href="http://eprev.org/images/icon.png"><link rel="alternate" type="application/atom+xml" title="Feed" href="http://eprev.org/atom.xml"><link rel="canonical" href="http://eprev.org/2017/02/20/make-as-a-front-end-development-build-tool/"><meta property="og:url" content="http://eprev.org/2017/02/20/make-as-a-front-end-development-build-tool/"><meta property="og:title" content="Make as a front-end development build tool"><meta property="og:site_name" content="Anton Eprev"><meta property="og:type" content="article"><meta property="og:description" content="A practical introduction to Make as a front-end development build tool."><meta property="og:image" content="http://eprev.org/images/posts/make-as-a-front-end-development-build-tool.png"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="http://eprev.org/images/posts/make-as-a-front-end-development-build-tool.png"><meta name="twitter:creator" content="@eprev"><meta name="twitter:title" content="Make as a front-end development build tool"><meta name="twitter:description" content="A practical introduction to Make as a front-end development build tool."><script>if(function(e,n,t,a,r,o,i){e.GoogleAnalyticsObject=r,e[r]=e[r]||function(){(e[r].q=e[r].q||[]).push(arguments)},e[r].l=1*new Date,o=n.createElement(t),i=n.getElementsByTagName(t)[0],o.async=1,o.src=a,i.parentNode.insertBefore(o,i)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-12144011-2",{siteSpeedSampleRate:100}),ga("set","transport","beacon"),ga("send","pageview"),window.addEventListener("error",function(e){ga("send","event","JavaScript Error",e.message,e.filename?e.filename+":"+e.lineno:"N/A",{nonInteraction:1})}),window.performance&&void 0!==document.hidden){var prevTimeStamp=performance.now(),timeOnPage=0,accTimeOnPage=function(){document.hidden?timeOnPage+=Math.round(performance.now()-prevTimeStamp):prevTimeStamp=performance.now()};document.addEventListener("visibilitychange",accTimeOnPage),window.addEventListener("unload",function(){accTimeOnPage(),ga("send","timing","Engagement","Time On Page",timeOnPage,{transport:"beacon"})})}var html=document.documentElement;if(sessionStorage.fontsLoaded)html.classList.add("fonts-loaded");else{var script=document.createElement("script");script.src="http://eprev.org/assets/fontfaceobserver-33d2e58a345f3e3ae321cf9c3f99fc74.js",script.async=!0,script.onload=function(){Promise.all([new FontFaceObserver("Merriweather Sans",{weight:300}).load(),new FontFaceObserver("Merriweather Sans",{weight:700}).load(),new FontFaceObserver("Merriweather Sans",{weight:300,style:"italic"}).load(),new FontFaceObserver("Merriweather",{weight:400}).load()]).then(function(){html.classList.add("fonts-loaded"),sessionStorage.fontsLoaded="yes"})},document.head.appendChild(script)}</script><div class="page"><div class="page__sidebar"><div class="page__user-picture-story"><a class="page__user-name g--ff-serif" href="/">@eprev</a> <svg class="page__user-picture" viewBox="0 0 484 570"><path d="M39 503v67h343v-67H39z" fill="#feffff"/><path d="M10.502 569.5v-41c0-28 37.29-41.04 37.29-41.04L127.5 556.5H150v13H10.502zM367 437h27c19 0 65.5 0 85 83v50H367V437zM255 553.5h33v16h-33v-16z" fill="#ff2600"/><path d="M39 191v282c0 19.5 51.5 84 87 84h171c49 0 85-66.5 85-84V191c0-4-48-80-52-80H90.5c-4 0-51.5 80-51.5 80" fill="#ffd400"/><path d="M38 268.92v-122.5c0-34.5 22.736-33.687 53-34-21.5.5-27.5-28.5-27.5-43.5 0-14.5 0-41.5 29-55.5 28.5-14 69.5 4 69.5 4s-20.5 18-34 51.5c1.5 9.5 9 4 9 4s13-41.5 100-63c95.5-9.5 197-16.5 246.5 0-19.5 66.5-101 103-147 102 46 1 46 34.5 46 34.5v122.5h-64v-157c0 9-216.5 7.5-216.5 7.5v150c-30-.5-64-.5-64-.5z" fill="#ff2600"/><path d="M417 342v-55c0-37-36-37-40-37h-15c-4 0-8 4-8 8v113c0 4 4 8 8 8h15c4 0 40 0 40-37M0 287v55c0 37 36 37 40 37h15c4 0 8-4 8-8V258c0-4-4-8-8-8H40c-4 0-40 0-40 37" fill="#ffd400"/><path d="M150 436v17h116v-17H150" fill="#770b00" data-id="mouth"/><path d="M279 342c-25.5 0-46-20.5-46-46s20.5-46 46-46 46 20.5 46 46-20.5 46-46 46m-142 0c-25.5 0-46-20.5-46-46s20.5-46 46-46 46 20.5 46 46-20.5 46-46 46" fill="#feffff"/><circle cx="137" cy="296" r="24" fill="#aad6d7" data-id="right-eye"/><circle cx="279" cy="296" r="24" fill="#aad6d7" data-id="left-eye"/><path d="M137.5 373c-42 0-76.5-34.5-76.5-76.5S95.5 220 137.5 220c32.003 0 59.65 20.03 71 48.147C219.85 240.03 247.497 220 279.5 220c42 0 76.5 34.5 76.5 76.5S321.5 373 279.5 373c-32.003 0-59.65-20.03-71-48.147C197.15 352.97 169.503 373 137.5 373m-.5-31c25.5 0 46-20.5 46-46s-20.5-46-46-46-46 20.5-46 46 20.5 46 46 46m142 0c25.5 0 46-20.5 46-46s-20.5-46-46-46-46 20.5-46 46 20.5 46 46 46" fill="#770b00"/></svg><div class="page__user-story">My name’s Anton Eprev and I’m a web developer working as front-end engineer at Booking.com in Amsterdam, Netherlands. I’m on <a href="https://twitter.com/eprev">Twitter</a>, <a href="https://github.com/eprev">GitHub</a> and <a href="https://unsplash.com/@eprev">Unsplash</a>.</div></div><ul class="page__nav"><li><a href="/">Home</a></li><li><a href="/archive/">Archive</a></li><li><a href="/tags/">Tags</a></li></ul></div><div class="page__content"><div class="post"><h1 class="post__header">Make as a front-end development build tool</h1><div class="post__meta g--shady">February 20, 2017 ∙ 11 minutes read ∙ <a href="/tags/makefile/">makefile</a>, <a href="/tags/devops/">devops</a></div><div class="post__content"><blockquote class="epigraph"><p>Make is turning 40 in 2017.</p></blockquote><p>This is a practical introduction to Make as a front-end development build tool. I will give the basic understanding of how makefiles work and show how to get the most common front-end tasks done using Make. However I encourage you to read the <a href="http://www.gnu.org/software/make/manual/make.html">official manual</a> through.</p><p>Why even bother with Make? Make is a powerful tool which is not limited to building packages. You can use it for anything you do from copying files or running webpack to deploying your project. I use this <a href="https://raw.githubusercontent.com/eprev/eprev.org/df2e82563c2e444f8116dc4e9fe1f56dcdc56984/Makefile">makefile</a> to build and deploy this very web site. These are the tasks that it carries out for me:</p><ul><li>Running Jekyll</li><li>Watching for changes in JavaScript source files</li><li>Building JavaScript bundles</li><li>Minifying static assets (CSS, JavaScript and HTML)</li><li>Versioning static assets</li><li>Deploying the web site to GitHub Pages</li></ul><p>And that makefile is less than 80 lines of code!</p><h2 id="makefile-basics">Makefile basics</h2><p>Any makefile consists of “rules”: build targets, their dependencies and series of commands (recipes) to build those targets:</p><figure class="highlight highlight--lang-make"><pre><code><span class="nl">target …</span><span class="o">:</span> <span class="nf">dependency …</span>
    <span class="nb">command</span>
    …</code></pre></figure><p><strong>Please note:</strong> each command must begin with a tab character.</p><p>Here’s a simple makefile:</p><figure class="highlight highlight--lang-make"><pre><code><span class="nl">dist/main.js</span><span class="o">:</span> <span class="nf">src/main.js</span>
    mkdir -p dist
    cp src/main.js dist/main.js</code></pre></figure><p>On the first line we have the <code>dist/main.js</code> target with the <code>src/main.js</code> file as the only dependency. In order to build this target, Make will execute <code>mkdir</code> and <code>cp</code> commands. The former creates the directory if it doesn’t exist and the later puts a copy of the source file to that directory.</p><p>To use this makefile to create the target file, type <code>make</code>:</p><figure class="highlight highlight--lang-shell"><pre><code><span class="gp">$ </span>make
mkdir -p dist
cp src/main.js dist/main.js</code></pre></figure><p>If no dependencies have changed after the target was generated, <code>make</code> won’t update that target. That’s why if you run it twice in a row, <code>make</code> won’t copy any files on the second run:</p><figure class="highlight highlight--lang-shell"><pre><code><span class="gp">$ </span>make
make: <span class="s1">'dist/main.js'</span> is up to date.</code></pre></figure><p>Anyway, it required quite a bit of typing just to copy a file. Our recipe can be improved by using <a href="https://www.gnu.org/software/make/manual/make.html#Automatic-Variables">automatic variables</a>:</p><figure class="highlight highlight--lang-make"><pre><code><span class="nl">dist/main.js</span><span class="o">:</span> <span class="nf">src/main.js</span>
    mkdir -p <span class="err">$</span><span class="o">(</span>@D<span class="o">)</span>
    cp <span class="nv">$&lt;</span> <span class="nv">$@</span></code></pre></figure><p>Where:</p><ul><li><code>$@</code> – The file name of the target.</li><li><code>$&lt;</code> – The file name of the first dependency.</li><li><code>$(@D)</code> – The directory part of the file name of the target.</li></ul><p>That’s better. Now, what if we have more than one JavaScript file to copy? We can replace our explicit rule with a <a href="https://www.gnu.org/software/make/manual/make.html#Pattern-Rules">pattern rule</a>:</p><figure class="highlight highlight--lang-make"><pre><code><span class="nl">dist/%.js</span><span class="o">:</span> <span class="nf">src/%.js</span>
    mkdir -p <span class="err">$</span><span class="o">(</span>@D<span class="o">)</span>
    cp <span class="nv">$&lt;</span> <span class="nv">$@</span></code></pre></figure><p>Where <code>%</code> in the target matches any non-empty substring, and <code>%</code> in the dependency represents the same matched substring in the target.</p><p>If you were to run <code>make</code> this time, it would fail:</p><figure class="highlight highlight--lang-shell"><pre><code><span class="gp">$ </span>make
make: <span class="k">***</span> No targets.  Stop.</code></pre></figure><p>It doesn’t know which target it should be building now, since there’s no longer explicit rules in the makefile. You would need to pass the desired target name in the arguments:</p><figure class="highlight highlight--lang-shell"><pre><code><span class="gp">$ </span>make dist/main.js
mkdir -p dist
cp src/main.js dist/main.js</code></pre></figure><p>This doesn’t seem handy though. Instead, we could define a new rule called <code>all</code> with the <code>dist/main.js</code> file as the dependency and an empty recipe:</p><figure class="highlight highlight--lang-make"><pre><code><span class="nl">all</span><span class="o">:</span> <span class="nf">dist/main.js</span>

<span class="nl">dist/%.js</span><span class="o">:</span> <span class="nf">src/%.js</span>
    mkdir -p <span class="err">$</span><span class="o">(</span>@D<span class="o">)</span>
    cp <span class="nv">$&lt;</span> <span class="nv">$@</span></code></pre></figure><p>Now, <code>make</code> will start with the <code>all</code> target. In order to “build” it, it has to find the dependency file <code>dist/main.js</code>, and if the later doesn’t exist, it will look for a rule to create it.</p><p>But this doesn’t seem to be a scalable solution either. What if Make could actually find the existing files in the <code>src</code> directory and based on them create the list of dependencies for the <code>all</code> target? Now we’re getting somewhere:</p><figure class="highlight highlight--lang-make"><pre><code><span class="nl">all</span><span class="o">:</span> <span class="nf">$(subst src/</span><span class="p">,</span><span class="nf">dist/</span><span class="p">,</span><span class="nf">$(wildcard src/*.js))</span>

<span class="nl">dist/%.js</span><span class="o">:</span> <span class="nf">src/%.js</span>
    mkdir -p <span class="err">$</span><span class="o">(</span>@D<span class="o">)</span>
    cp <span class="nv">$&lt;</span> <span class="nv">$@</span></code></pre></figure><p>Those <code>wildcard</code> and <code>subst</code> are Make’s <a href="https://www.gnu.org/software/make/manual/make.html#Functions">functions</a>. The former returns a space-separated list of names of existing files that match the given pattern <code>src/*.js</code>, and the later replaces <code>src/</code> with <code>dist/</code> in that list.</p><p>And finally, we could use <a href="https://www.gnu.org/software/make/manual/make.html#Using-Variables">variables</a> to store the directory names, so we won’t have to update rules in the makefile if the structure of our project changes:</p><figure class="highlight highlight--lang-make"><pre><code><span class="nv">SRC_DIR</span>  <span class="o">:=</span> src
<span class="nv">DIST_DIR</span> <span class="o">:=</span> dist

<span class="nl">all</span><span class="o">:</span> <span class="nf">$(subst $(SRC_DIR)/</span><span class="p">,</span><span class="nf">$(DIST_DIR)/</span><span class="p">,</span><span class="nf">$(wildcard $(SRC_DIR)/*.js))</span>

<span class="nl">$(DIST_DIR)/%.js</span><span class="o">:</span> <span class="nf">$(SRC_DIR)/%.js</span>
    mkdir -p <span class="err">$</span><span class="o">(</span>@D<span class="o">)</span>
    cp <span class="nv">$&lt;</span> <span class="nv">$@</span></code></pre></figure><h2 id="make-by-example">Make by example</h2><p>In the next sections I will explain some parts of the <a href="https://raw.githubusercontent.com/eprev/eprev.org/df2e82563c2e444f8116dc4e9fe1f56dcdc56984/Makefile">makefile</a> that I use to build and deploy this web site. I hope these examples are good enough for you to get started.</p><h3 id="building-javascript-bundles">Building JavaScript bundles</h3><p>I keep JavaScript files in the <code>js</code> directory. All the files contained within the <code>js</code> directory are bundles, that may import other source files from the subdirectories. Basically, the folder structure looks like this:</p><figure class="highlight highlight--lang-text"><pre><code>.
├── assets/
├── js/
│   ├── src/
│   │   ├── ga.js
│   │   └── polyfills.js
│   └── main.js
└── Makefile</code></pre></figure><p>The <code>js/main.js</code> file is used as the entry point for <a href="http://rollupjs.org/">Rollup</a> to create the resulting bundle in the <code>assets</code> directory. I have a target called <code>build-assets</code> in the makefile that does it:</p><figure class="highlight highlight--lang-make"><pre><code><span class="nv">ROLLUP</span> <span class="o">:=</span> ./node_modules/.bin/rollup
<span class="nv">ROLLUPFLAGS</span> <span class="o">:=</span> --format<span class="o">=</span>iife --sourcemap

<span class="nv">JS_DIRECTORY</span> <span class="o">:=</span> js
<span class="nv">ASSETS_DIRECTORY</span> <span class="o">:=</span> assets
<span class="nv">JS_ASSETS</span> <span class="o">:=</span> <span class="err">$</span><span class="o">(</span>subst <span class="nv">$(JS_DIRECTORY)</span>/,<span class="nv">$(ASSETS_DIRECTORY)</span>/,<span class="err">$</span><span class="o">(</span>wildcard <span class="nv">$(JS_DIRECTORY)</span>/<span class="k">*</span>.js<span class="o">))</span>

<span class="nl">clean-assets</span><span class="o">:</span>
    rm -rf <span class="nv">$(ASSETS_DIRECTORY)</span>/<span class="k">*</span>

<span class="nl">$(ASSETS_DIRECTORY)/%.js</span><span class="o">:</span> <span class="nf">$(JS_DIRECTORY)/%.js</span>
    <span class="nv">$(ROLLUP)</span> <span class="nv">$(ROLLUPFLAGS)</span> -i <span class="nv">$&lt;</span> -o <span class="nv">$@</span>

<span class="nl">build-assets</span><span class="o">:</span> <span class="nf">clean-assets $(JS_ASSETS)</span></code></pre></figure><p>This is very similar to what we have done earlier to copy multiple JavaScript files.</p><h3 id="watching-for-changes">Watching for changes</h3><p><a href="https://github.com/emcrisostomo/fswatch"><code>fswatch</code></a> is a cross-platform file change monitor that gets notified when the contents of the particular files or directories are modified. You can use <a href="https://brew.sh">Homebrew</a> to install it:</p><figure class="highlight highlight--lang-shell"><pre><code><span class="gp">$ </span>brew install fswatch</code></pre></figure><p>I have the <code>watch</code> target in the makefile, which starts <code>fswatch</code> and will run <code>make build-assets</code> when any of JavaScript files changes:</p><figure class="highlight highlight--lang-make"><pre><code><span class="nl">watch</span><span class="o">:</span>
    fswatch -o <span class="nv">$(JS_DIRECTORY)</span> | xargs -n1 -I<span class="o">{}</span> <span class="nv">$(MAKE)</span> build-assets</code></pre></figure><p>This command performs the following operations:</p><ul><li>The <code>fswatch -o js</code> command will start watching for file changes in the <code>js</code> directory. The <code>-o</code> option tells <code>fswatch</code> to batch change events.</li><li>The <code>xargs -n1</code> command will execute the <code>$(MAKE) build-assets</code> command each time <code>fswatch</code> detects a change.</li><li>The <code>-I{}</code> option will substitute occurrences of <code><span class="p">{}</span></code> in the given command with the string from the standard input. Even though we don’t have <code><span class="p">{}</span></code> in the command, without this option <code>xargs</code> will execute <code>make</code> with two arguments (instead of one): <code>build-assets</code> and the string it gets from the standard input.</li></ul><p>To start watching for changes, type:</p><figure class="highlight highlight--lang-shell"><pre><code><span class="gp">$ </span>make watch</code></pre></figure><p>To stop, press <code>Ctrl-C</code>.</p><h3 id="minifying-static-assets">Minifying static assets</h3><p>Here I use <a href="https://github.com/babel/babili">Babili</a> to minify ES6 JavaScript bundles after they are generated by <code>build-assets</code>:</p><figure class="highlight highlight--lang-make"><pre><code><span class="nv">BABILI</span> <span class="o">:=</span> ./node_modules/.bin/babili
<span class="nv">BABILIFLAGS</span> <span class="o">:=</span> --no-comments

<span class="nl">compress-assets</span><span class="o">:</span> <span class="nf">build-assets</span>
    <span class="nv">$(BABILI)</span> <span class="nv">$(ASSETS_DIRECTORY)</span> -d <span class="nv">$(ASSETS_DIRECTORY)</span> <span class="nv">$(BABILIFLAGS)</span></code></pre></figure><p>The same way you can use, for instance, <a href="http://cssnano.co">cssnano</a> and <a href="https://github.com/kangax/html-minifier">html-minifier</a> to compress CSS and HTML.</p><h3 id="versioning-static-assets">Versioning static assets</h3><p>Caching is important, so is a strategy for breaking the cache and making the browsers download updated resources.</p><p>The popular approach is to include the hash of the file contents in its name, eg. <code>assets/main-a2f40c.js</code>. This way it guarantees the file name won’t change during the building process if its contents remains the same.</p><p>If you choose this approach, you will have to generate the manifest file in order to reference those files in the HTML or CSS. And here is the <code>build-manifest</code> target in the makefile that does it:</p><figure class="highlight highlight--lang-make"><pre><code><span class="nv">MANIFEST_FILE</span> <span class="o">:=</span> _data/manifest.yml

<span class="nl">clean-manifest</span><span class="o">:</span>
    rm -f <span class="nv">$(MANIFEST_FILE)</span>

<span class="nl">build-manifest</span><span class="o">:</span> <span class="nf">clean-manifest compress-assets</span>
    <span class="p">@</span><span class="k">for </span>filename <span class="k">in</span> <span class="err">$$</span><span class="o">(</span> find <span class="nv">$(ASSETS_DIRECTORY)</span> -type f -exec basename <span class="o">{}</span> <span class="se">\;</span> <span class="o">)</span>; <span class="k">do</span> <span class="se">\</span>
        <span class="nb">hash</span><span class="o">=</span><span class="err">$$</span><span class="o">(</span>md5 -q <span class="nv">$(ASSETS_DIRECTORY)</span>/<span class="nv">$$</span>filename<span class="o">)</span>; <span class="se">\</span>
        <span class="nv">hashed_filename</span><span class="o">=</span><span class="s2">"</span><span class="nv">$$</span><span class="s2">{filename%%.*}-</span><span class="nv">$$</span><span class="s2">hash.</span><span class="nv">$$</span><span class="s2">{filename#*.}"</span>; <span class="se">\</span>
        cp <span class="nv">$(ASSETS_DIRECTORY)</span>/<span class="nv">$$</span>filename <span class="nv">$(ASSETS_DIRECTORY)</span>/<span class="nv">$$</span>hashed_filename; <span class="se">\</span>
        <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$$</span><span class="s2">filename: </span><span class="nv">$$</span><span class="s2">hashed_filename"</span> &gt;&gt; <span class="nv">$(MANIFEST_FILE)</span>; <span class="se">\</span>
    <span class="k">done</span></code></pre></figure><p>Firstly, Make executes each line in a recipe separately. And if you need to write multi-line command, then you can use line continuations. Make also prints out each command before it gets executed, and the <code>@</code> character in the start of the line prevents the command from such echoing.</p><p>Secondly, the <code>$</code> character is used to reference variables in makefiles, so does the shell. And in order to get <code>$filename</code> passed to the shell, rather than having Make trying to find a variable called <code>filename</code>, we need to write <code>$$filename</code>.</p><p>Thus, this is actually what Make will pass to the shell (Bash) when running <code>build-manifest</code>:</p><figure class="highlight highlight--lang-shell"><pre><code><span class="k">for </span>filename <span class="k">in</span> <span class="k">$(</span> find assets -type f -exec basename <span class="o">{}</span> <span class="se">\;</span> <span class="k">)</span>; <span class="k">do</span> <span class="se">\</span>
    <span class="nb">hash</span><span class="o">=</span><span class="k">$(</span>md5 -q assets/<span class="nv">$filename</span><span class="k">)</span>; <span class="se">\</span>
    <span class="nv">hashed_filename</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">filename</span><span class="p">%%.*</span><span class="k">}</span><span class="s2">-</span><span class="nv">$hash</span><span class="s2">.</span><span class="k">${</span><span class="nv">filename</span><span class="p">#*.</span><span class="k">}</span><span class="s2">"</span>; <span class="se">\</span>
    cp asstes/<span class="nv">$filename</span> assets/<span class="nv">$hashed_filename</span>; <span class="se">\</span>
    <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$filename</span><span class="s2">: </span><span class="nv">$hashed_filename</span><span class="s2">"</span> &gt;&gt; _data/manifest.yml; <span class="se">\</span>
<span class="k">done</span></code></pre></figure><p>This command performs the following operations:</p><ul><li>The <code>find assets -type f -exec basename {} \;</code> command will find all files in the <code>assets</code> directory.</li><li>The <code>md5 -q assets/$filename</code> command will calculate a checksum for the given file.</li><li>The <code>${filename%%.*}</code> operation will delete the longest match of <code>.*</code> from the back of <code>$filename</code>. If <code>$filename</code> was containing <code>main.js.map</code>, it would keep the <code>main</code> part only.</li><li>The <code>${filename#*.}</code> operation will delete the shortest match of <code>*.</code> from the front of <code>$filename</code>. If <code>$filename</code> was containing <code>main.js.map</code>, it would keep the <code>js.map</code> part only.</li><li>The <code>echo "…" &gt;&gt; _data/manifest.yml</code> command will append a string containing both file names to the manifest file.</li></ul><p>Basically, for each file that it finds in the <code>assets</code> directory, it will calculate a checksum, make a copy of the file and generate the manifest file containing key-value pairs:</p><figure class="highlight highlight--lang-text"><pre><code>main.js: main-a2f40c69875a90f46f961febe52d4989.js
…</code></pre></figure><p>This is how I use this information later in Jekyll to reference JavaScript bundles:</p><figure class="highlight highlight--lang-liquid"><pre><code><span class="p">{%</span><span class="w"> </span><span class="kr">if</span><span class="w"> </span><span class="nv">site</span><span class="p">.</span><span class="nv">data</span><span class="p">.</span><span class="nv">manifest</span><span class="w"> </span><span class="p">%}</span>
    &lt;script src="<span class="p">{{</span><span class="w"> </span><span class="nv">site</span><span class="p">.</span><span class="nv">url</span><span class="w"> </span><span class="p">}}</span>/assets/<span class="p">{{</span><span class="w"> </span><span class="nv">site</span><span class="p">.</span><span class="nv">data</span><span class="p">.</span><span class="nv">manifest</span><span class="p">[</span><span class="s1">'main.js'</span><span class="p">]</span><span class="w"> </span><span class="p">}}</span>"&gt;&lt;/srcipt&gt;
<span class="p">{%</span><span class="w"> </span><span class="kr">else</span><span class="w"> </span><span class="p">%}</span>
    &lt;script src="<span class="p">{{</span><span class="w"> </span><span class="nv">site</span><span class="p">.</span><span class="nv">url</span><span class="w"> </span><span class="p">}}</span>/assets/main.js"&gt;&lt;/srcipt&gt;
<span class="p">{%</span><span class="w"> </span><span class="kr">endif</span><span class="w"> </span><span class="p">%}</span></code></pre></figure><h3 id="deploying-to-github-pages">Deploying to GitHub Pages</h3><p>I keep the source code of the web site in the <code>master</code> branch and the contents of the <code>_site</code> directory in the <code>gh-pages</code> branch. Thus, to publish a new version of the web site I just need to push changes in the <code>_site</code> directory to GitHub. To automate this I created a target called <code>deploy</code>:</p><figure class="highlight highlight--lang-make"><pre><code><span class="nl">build-deploy</span><span class="o">:</span> <span class="nf">build</span>
    …
    <span class="nv">JEKYLL_ENV</span><span class="o">=</span>production bundle <span class="nb">exec </span>jekyll build
    …

<span class="nl">reset-site</span><span class="o">:</span>
    git --git-dir<span class="o">=</span>_site/.git reset --hard origin/gh-pages
    git --git-dir<span class="o">=</span>_site/.git pull origin gh-pages

<span class="nl">deploy</span><span class="o">:</span> <span class="nf">reset-site build-deploy</span>
    git --git-dir<span class="o">=</span>_site/.git add -A
    git --git-dir<span class="o">=</span>_site/.git commit -m <span class="s2">"Deploy"</span>
    git --git-dir<span class="o">=</span>_site/.git push origin gh-pages</code></pre></figure><h2 id="conclusion">Conclusion</h2><p>Make is a great cross-platform tool suitable for projects of different sizes and complexities. More powerful and expressive than NPM scripts, Grunt or Gulp.</p><p>And I hope this article has sparked your interest in learning and getting out of your comfort zone as a front-end developer.</p></div></div><div class="post-share g--shady"><svg viewBox="0 0 400 400" class="post-share__icon"><path fill="#1da1f2" d="M153.62,301.59c94.34,0,145.94-78.16,145.94-145.94,0-2.22,0-4.43-.15-6.63A104.36,104.36,0,0,0,325,122.47a102.38,102.38,0,0,1-29.46,8.07,51.47,51.47,0,0,0,22.55-28.37,102.79,102.79,0,0,1-32.57,12.45,51.34,51.34,0,0,0-87.41,46.78A145.62,145.62,0,0,1,92.4,107.81a51.33,51.33,0,0,0,15.88,68.47A50.91,50.91,0,0,1,85,169.86c0,.21,0,.43,0,.65a51.31,51.31,0,0,0,41.15,50.28,51.21,51.21,0,0,1-23.16.88,51.35,51.35,0,0,0,47.92,35.62,102.92,102.92,0,0,1-63.7,22A104.41,104.41,0,0,1,75,278.55a145.21,145.21,0,0,0,78.62,23"/></svg> If you liked this post and think others should read it, please <a data-ga-on="click" data-ga-category="Social" data-ga-action="Twitter" data-ga-label="http://eprev.org/2017/02/20/make-as-a-front-end-development-build-tool/" href="http://twitter.com/intent/tweet?url=http://eprev.org/2017/02/20/make-as-a-front-end-development-build-tool/&amp;text=Make%20as%20a%20front-end%20development%20build%20tool">share it on Twitter</a>.</div><div class="post-comments" data-issue-id="18">Want to leave a comment on this? Visit <a href="https://github.com/eprev/eprev.org/issues/18">the post’s issue page</a> on GitHub.</div><div class="post-special-home"><a href="/">Home</a></div></div></div></html>