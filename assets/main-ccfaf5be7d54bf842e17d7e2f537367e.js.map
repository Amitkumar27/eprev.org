{"version":3,"file":"main.js","sources":["../js/src/polyfills.js","../js/src/Eyed.js","../js/main.js"],"sourcesContent":["const ElementPrototype = Element.prototype;\nif (typeof ElementPrototype.matches !== 'function') {\n  ElementPrototype.matches = ElementPrototype.msMatchesSelector;\n}\n\nif (typeof ElementPrototype.closest !== 'function') {\n  ElementPrototype.closest = function (selector) {\n    let element = this; // eslint-disable-line consistent-this\n\n    while (element && element.nodeType === 1) {\n      if (element.matches(selector)) {\n        return element;\n      }\n      element = element.parentNode;\n    }\n\n    return null;\n  };\n}\n","const { PI, abs, min, sin, cos, atan } = Math;\n\nfunction throttle(fn, context) {\n  let running = false;\n  return function throttled(...args) {\n    if (running) {\n      return;\n    }\n    running = true;\n    requestAnimationFrame(() => {\n      fn.apply(context, args);\n      running = false;\n    });\n  };\n}\n\n// Edge doesn't apply CSS transforms on SVG elements\nconst isCSSTransformSupportedOnSVG = (() => {\n  const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n  svg.setAttribute('viewBox', '0 0 2 2');\n  Object.assign(svg.style, {\n    position: 'absolute',\n    top: 0,\n    left: 0,\n    width: '2px',\n    height: '2px',\n  });\n  svg.innerHTML = '<rect width=\"1\" height=\"1\" style=\"transform: translate(1px, 1px)\"/>';\n  document.body.appendChild(svg);\n  const result = document.elementFromPoint(1, 1) !== svg;\n  svg.parentNode.removeChild(svg);\n  return result;\n})();\n\nconst EYE_MAX_RADIUS = 24;\nconst MOUTH_CX = 208;\nconst MOUTH_CY = 436;\nconst MOUTH_SCALE_X = 0.25;\nconst MOUTH_SCALE_Y = 1.5;\n\nexport function Eyed(rootEl) {\n\n  const eyes = [\n    {el: rootEl.querySelector('[data-id=right-eye]')},\n    {el: rootEl.querySelector('[data-id=left-eye]')},\n  ];\n  const mouthEl = rootEl.querySelector('[data-id=mouth]');\n\n  if (isCSSTransformSupportedOnSVG) {\n    eyes.forEach((eye) => eye.el.style.willChange = 'transform');\n    Object.assign(mouthEl.style, {\n      willChange: 'transform',\n      transitionDuration: '.25s',\n      transitionProperty: 'transform',\n    });\n  }\n\n  let mouthTransformTimer = null;\n  let isMouthOpen = false;\n\n  const onWindowScroll = throttle(() => {\n    checkVisibility();\n  });\n  const onMouseMove = throttle((e) => {\n    eyes.forEach((eye) => {\n      moveEye(eye.el, e.pageX - eye.left, eye.top - e.pageY);\n    });\n    if (e.target.closest('a')) {\n      openMouth();\n    } else {\n      closeMouth();\n    }\n  });\n\n  // Listen for scroll and resize events and check if the 4-eyed head\n  // is within the viewport\n  window.addEventListener('scroll', onWindowScroll, {passive: true});\n  window.addEventListener('resize', onWindowScroll);\n\n  checkVisibility();\n\n  // Return public interface\n  return {\n    resume,\n    pause,\n  };\n\n  function checkVisibility() {\n    const windowHeight = window.innerHeight;\n    const { top, bottom, height } = rootEl.getBoundingClientRect();\n    if (\n         top >= 0 && top < windowHeight\n      || bottom > 0 && bottom <= windowHeight\n      || height > windowHeight && top < 0 && bottom > windowHeight\n    ) {\n        resume();\n    } else {\n        pause();\n    }\n  }\n\n  function resume() {\n    // Get the position of the every eye\n    eyes.forEach((eye) => {\n      const { left, top, width, height } = eye.el.getBoundingClientRect();\n      eye.left = left + window.pageXOffset + width / 2;\n      eye.top = top + window.pageYOffset + height / 2;\n    });\n\n    document.addEventListener('mousemove', onMouseMove);\n  }\n\n  function pause() {\n    closeMouth();\n\n    document.removeEventListener('mousemove', onMouseMove);\n  }\n\n  function translate(el, dx, dy) {\n    if (isCSSTransformSupportedOnSVG) {\n      el.style.transform = `translate(${dx}px, ${dy}px)`;\n    } else {\n      el.setAttribute('transform', `translate(${dx} ${dy})`);\n    }\n  }\n\n  function scale(el, sx = 1, sy = 1, cx = 0, cy = 0) {\n    // We could use `scale()` function and `transform-origin: center`, but:\n    // 1) the later doesn't work properly in FF: keywords and percentages refer\n    //    to the canvas instead of the object itself (see\n    //    https://bugzilla.mozilla.org/show_bug.cgi?id=1209061)\n    // 2) there's no such thing as `transform-origin` in SVG.\n    // Hence we are gonna use `matrix` function instead.\n    const transform = `matrix(${sx}, 0, 0, ${sy}, ${cx * (1 - sx)}, ${cy * (1 - sy)})`;\n    if (isCSSTransformSupportedOnSVG) {\n      mouthEl.style.transform = transform;\n    } else {\n      mouthEl.setAttribute('transform', transform);\n    }\n  }\n\n  function moveEye(el, x, y) {\n    const angle = x\n      ? (x < 0 ? PI + atan( y / x ) : atan( y / x ))\n      : 0;\n    const dx = min(EYE_MAX_RADIUS, abs(x)) * cos(angle);\n    const dy = min(EYE_MAX_RADIUS, abs(y)) * sin(angle) * -1;\n\n    translate(el, dx, dy);\n  }\n\n  function openMouth() {\n    if (!isMouthOpen) {\n      isMouthOpen = true;\n      clearTimeout(mouthTransformTimer);\n      mouthTransformTimer = setTimeout(\n        () => scale(mouthEl, MOUTH_SCALE_X, MOUTH_SCALE_Y, MOUTH_CX, MOUTH_CY),\n        250\n      );\n    }\n  }\n\n  function closeMouth() {\n    if (isMouthOpen) {\n      isMouthOpen = false;\n      clearTimeout(mouthTransformTimer);\n      mouthTransformTimer = setTimeout(\n        () => scale(mouthEl),\n        125\n      );\n    }\n  }\n\n}\n","import './src/polyfills';\nimport { Eyed } from './src/Eyed';\n\nEyed( document.querySelector('.page__user-picture') );\n"],"names":[],"mappings":";;;AAAA,MAAM,gBAAgB,GAAG,OAAO,CAAC,SAAS,CAAC;AAC3C,IAAI,OAAO,gBAAgB,CAAC,OAAO,KAAK,UAAU,EAAE;EAClD,gBAAgB,CAAC,OAAO,GAAG,gBAAgB,CAAC,iBAAiB,CAAC;CAC/D;;AAED,IAAI,OAAO,gBAAgB,CAAC,OAAO,KAAK,UAAU,EAAE;EAClD,gBAAgB,CAAC,OAAO,GAAG,UAAU,QAAQ,EAAE;IAC7C,IAAI,OAAO,GAAG,IAAI,CAAC;;IAEnB,OAAO,OAAO,IAAI,OAAO,CAAC,QAAQ,KAAK,CAAC,EAAE;MACxC,IAAI,OAAO,CAAC,OAAO,CAAC,QAAQ,CAAC,EAAE;QAC7B,OAAO,OAAO,CAAC;OAChB;MACD,OAAO,GAAG,OAAO,CAAC,UAAU,CAAC;KAC9B;;IAED,OAAO,IAAI,CAAC;GACb,CAAC;CACH;;AClBD,MAAM,EAAE,EAAE,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,IAAI,EAAE,GAAG,IAAI,CAAC;;AAE9C,SAAS,QAAQ,CAAC,EAAE,EAAE,OAAO,EAAE;EAC7B,IAAI,OAAO,GAAG,KAAK,CAAC;EACpB,OAAO,SAAS,SAAS,CAAC,GAAG,IAAI,EAAE;IACjC,IAAI,OAAO,EAAE;MACX,OAAO;KACR;IACD,OAAO,GAAG,IAAI,CAAC;IACf,qBAAqB,CAAC,MAAM;MAC1B,EAAE,CAAC,KAAK,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC;MACxB,OAAO,GAAG,KAAK,CAAC;KACjB,CAAC,CAAC;GACJ,CAAC;CACH;;;AAGD,MAAM,4BAA4B,GAAG,CAAC,MAAM;EAC1C,MAAM,GAAG,GAAG,QAAQ,CAAC,eAAe,CAAC,4BAA4B,EAAE,KAAK,CAAC,CAAC;EAC1E,GAAG,CAAC,YAAY,CAAC,SAAS,EAAE,SAAS,CAAC,CAAC;EACvC,MAAM,CAAC,MAAM,CAAC,GAAG,CAAC,KAAK,EAAE;IACvB,QAAQ,EAAE,UAAU;IACpB,GAAG,EAAE,CAAC;IACN,IAAI,EAAE,CAAC;IACP,KAAK,EAAE,KAAK;IACZ,MAAM,EAAE,KAAK;GACd,CAAC,CAAC;EACH,GAAG,CAAC,SAAS,GAAG,qEAAqE,CAAC;EACtF,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC;EAC/B,MAAM,MAAM,GAAG,QAAQ,CAAC,gBAAgB,CAAC,CAAC,EAAE,CAAC,CAAC,KAAK,GAAG,CAAC;EACvD,GAAG,CAAC,UAAU,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC;EAChC,OAAO,MAAM,CAAC;CACf,GAAG,CAAC;;AAEL,MAAM,cAAc,GAAG,EAAE,CAAC;AAC1B,MAAM,QAAQ,GAAG,GAAG,CAAC;AACrB,MAAM,QAAQ,GAAG,GAAG,CAAC;AACrB,MAAM,aAAa,GAAG,IAAI,CAAC;AAC3B,MAAM,aAAa,GAAG,GAAG,CAAC;;AAE1B,AAAO,SAAS,IAAI,CAAC,MAAM,EAAE;;EAE3B,MAAM,IAAI,GAAG;IACX,CAAC,EAAE,EAAE,MAAM,CAAC,aAAa,CAAC,qBAAqB,CAAC,CAAC;IACjD,CAAC,EAAE,EAAE,MAAM,CAAC,aAAa,CAAC,oBAAoB,CAAC,CAAC;GACjD,CAAC;EACF,MAAM,OAAO,GAAG,MAAM,CAAC,aAAa,CAAC,iBAAiB,CAAC,CAAC;;EAExD,IAAI,4BAA4B,EAAE;IAChC,IAAI,CAAC,OAAO,CAAC,CAAC,GAAG,KAAK,GAAG,CAAC,EAAE,CAAC,KAAK,CAAC,UAAU,GAAG,WAAW,CAAC,CAAC;IAC7D,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,KAAK,EAAE;MAC3B,UAAU,EAAE,WAAW;MACvB,kBAAkB,EAAE,MAAM;MAC1B,kBAAkB,EAAE,WAAW;KAChC,CAAC,CAAC;GACJ;;EAED,IAAI,mBAAmB,GAAG,IAAI,CAAC;EAC/B,IAAI,WAAW,GAAG,KAAK,CAAC;;EAExB,MAAM,cAAc,GAAG,QAAQ,CAAC,MAAM;IACpC,eAAe,EAAE,CAAC;GACnB,CAAC,CAAC;EACH,MAAM,WAAW,GAAG,QAAQ,CAAC,CAAC,CAAC,KAAK;IAClC,IAAI,CAAC,OAAO,CAAC,CAAC,GAAG,KAAK;MACpB,OAAO,CAAC,GAAG,CAAC,EAAE,EAAE,CAAC,CAAC,KAAK,GAAG,GAAG,CAAC,IAAI,EAAE,GAAG,CAAC,GAAG,GAAG,CAAC,CAAC,KAAK,CAAC,CAAC;KACxD,CAAC,CAAC;IACH,IAAI,CAAC,CAAC,MAAM,CAAC,OAAO,CAAC,GAAG,CAAC,EAAE;MACzB,SAAS,EAAE,CAAC;KACb,MAAM;MACL,UAAU,EAAE,CAAC;KACd;GACF,CAAC,CAAC;;;;EAIH,MAAM,CAAC,gBAAgB,CAAC,QAAQ,EAAE,cAAc,EAAE,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC,CAAC;EACnE,MAAM,CAAC,gBAAgB,CAAC,QAAQ,EAAE,cAAc,CAAC,CAAC;;EAElD,eAAe,EAAE,CAAC;;;EAGlB,OAAO;IACL,MAAM;IACN,KAAK;GACN,CAAC;;EAEF,SAAS,eAAe,GAAG;IACzB,MAAM,YAAY,GAAG,MAAM,CAAC,WAAW,CAAC;IACxC,MAAM,EAAE,GAAG,EAAE,MAAM,EAAE,MAAM,EAAE,GAAG,MAAM,CAAC,qBAAqB,EAAE,CAAC;IAC/D;SACK,GAAG,IAAI,CAAC,IAAI,GAAG,GAAG,YAAY;SAC9B,MAAM,GAAG,CAAC,IAAI,MAAM,IAAI,YAAY;SACpC,MAAM,GAAG,YAAY,IAAI,GAAG,GAAG,CAAC,IAAI,MAAM,GAAG,YAAY;MAC5D;QACE,MAAM,EAAE,CAAC;KACZ,MAAM;QACH,KAAK,EAAE,CAAC;KACX;GACF;;EAED,SAAS,MAAM,GAAG;;IAEhB,IAAI,CAAC,OAAO,CAAC,CAAC,GAAG,KAAK;MACpB,MAAM,EAAE,IAAI,EAAE,GAAG,EAAE,KAAK,EAAE,MAAM,EAAE,GAAG,GAAG,CAAC,EAAE,CAAC,qBAAqB,EAAE,CAAC;MACpE,GAAG,CAAC,IAAI,GAAG,IAAI,GAAG,MAAM,CAAC,WAAW,GAAG,KAAK,GAAG,CAAC,CAAC;MACjD,GAAG,CAAC,GAAG,GAAG,GAAG,GAAG,MAAM,CAAC,WAAW,GAAG,MAAM,GAAG,CAAC,CAAC;KACjD,CAAC,CAAC;;IAEH,QAAQ,CAAC,gBAAgB,CAAC,WAAW,EAAE,WAAW,CAAC,CAAC;GACrD;;EAED,SAAS,KAAK,GAAG;IACf,UAAU,EAAE,CAAC;;IAEb,QAAQ,CAAC,mBAAmB,CAAC,WAAW,EAAE,WAAW,CAAC,CAAC;GACxD;;EAED,SAAS,SAAS,CAAC,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE;IAC7B,IAAI,4BAA4B,EAAE;MAChC,EAAE,CAAC,KAAK,CAAC,SAAS,GAAG,CAAC,UAAU,EAAE,EAAE,CAAC,IAAI,EAAE,EAAE,CAAC,GAAG,CAAC,CAAC;KACpD,MAAM;MACL,EAAE,CAAC,YAAY,CAAC,WAAW,EAAE,CAAC,UAAU,EAAE,EAAE,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;KACxD;GACF;;EAED,SAAS,KAAK,CAAC,EAAE,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,GAAG,CAAC,EAAE,EAAE,GAAG,CAAC,EAAE;;;;;;;IAOjD,MAAM,SAAS,GAAG,CAAC,OAAO,EAAE,EAAE,CAAC,QAAQ,EAAE,EAAE,CAAC,EAAE,EAAE,EAAE,IAAI,CAAC,GAAG,EAAE,CAAC,CAAC,EAAE,EAAE,EAAE,IAAI,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;IACnF,IAAI,4BAA4B,EAAE;MAChC,OAAO,CAAC,KAAK,CAAC,SAAS,GAAG,SAAS,CAAC;KACrC,MAAM;MACL,OAAO,CAAC,YAAY,CAAC,WAAW,EAAE,SAAS,CAAC,CAAC;KAC9C;GACF;;EAED,SAAS,OAAO,CAAC,EAAE,EAAE,CAAC,EAAE,CAAC,EAAE;IACzB,MAAM,KAAK,GAAG,CAAC;SACV,CAAC,GAAG,CAAC,GAAG,EAAE,GAAG,IAAI,EAAE,CAAC,GAAG,CAAC,EAAE,GAAG,IAAI,EAAE,CAAC,GAAG,CAAC,EAAE;QAC3C,CAAC,CAAC;IACN,MAAM,EAAE,GAAG,GAAG,CAAC,cAAc,EAAE,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,GAAG,CAAC,KAAK,CAAC,CAAC;IACpD,MAAM,EAAE,GAAG,GAAG,CAAC,cAAc,EAAE,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,GAAG,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC;;IAEzD,SAAS,CAAC,EAAE,EAAE,EAAE,EAAE,EAAE,CAAC,CAAC;GACvB;;EAED,SAAS,SAAS,GAAG;IACnB,IAAI,CAAC,WAAW,EAAE;MAChB,WAAW,GAAG,IAAI,CAAC;MACnB,YAAY,CAAC,mBAAmB,CAAC,CAAC;MAClC,mBAAmB,GAAG,UAAU;QAC9B,MAAM,KAAK,CAAC,OAAO,EAAE,aAAa,EAAE,aAAa,EAAE,QAAQ,EAAE,QAAQ,CAAC;QACtE,GAAG;OACJ,CAAC;KACH;GACF;;EAED,SAAS,UAAU,GAAG;IACpB,IAAI,WAAW,EAAE;MACf,WAAW,GAAG,KAAK,CAAC;MACpB,YAAY,CAAC,mBAAmB,CAAC,CAAC;MAClC,mBAAmB,GAAG,UAAU;QAC9B,MAAM,KAAK,CAAC,OAAO,CAAC;QACpB,GAAG;OACJ,CAAC;KACH;GACF;;CAEF;;AC1KD,IAAI,EAAE,QAAQ,CAAC,aAAa,CAAC,qBAAqB,CAAC,EAAE,CAAC,;;"}